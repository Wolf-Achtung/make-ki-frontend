<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>KI-Readiness & Datenschutz</title>
<style>
    body {
        font-family: "IBM Plex Mono", monospace;
        background: #f7f9fb;
        color: #0d2b4a;
        padding: 2rem;
        max-width: 800px;
        margin: auto;
    }
    label { display: block; margin-top: 1rem; }
    input, select, textarea {
        width: 100%;
        padding: 0.8rem;
        margin-top: 0.5rem;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    .button {
        margin-top: 2rem;
        background: #003b5a;
        color: #fff;
        border: none;
        padding: 1rem;
        width: 100%;
        cursor: pointer;
        border-radius: 8px;
    }
    .button:hover { background: #005080; }
    .checkbox-block {
        margin-top: 1.5rem;
        font-size: 1rem;
    }
    .checkbox-block input[type="checkbox"] {
        width: auto;
        margin-right: 0.5rem;
    }
    pre {
        background: #eee;
        padding: 1rem;
        border-radius: 8px;
        margin-top: 2rem;
        overflow-x: auto;
    }
</style>
</head>
<body>

<h1>KI-Readiness & Datenschutz-Check</h1>
<form id="mainForm">
    <label>Email <input type="email" name="email" required></label>
    <label>Name <input type="text" name="name" required></label>
    <label>Unternehmen <input type="text" name="unternehmen"></label>
    <label>Branche <input type="text" name="branche"></label>
    <label>Geplanter Einsatzbereich <input type="text" name="einsatzbereich"></label>
    <label>Geplante Ma√ünahme <input type="text" name="ma√ünahme"></label>
    <label>Mitarbeiterzahl <input type="number" name="mitarbeiter"></label>
    <label>PLZ (f√ºr F√∂rderung) <input type="text" name="plz"></label>

    <div class="checkbox-block">
        <label><input type="checkbox" name="privacy" required> Ich akzeptiere die <a href="/datenschutz.html">Datenschutzerkl√§rung</a>.</label>
    </div>
    <div class="checkbox-block">
        <label><input type="checkbox" name="gpt_consent" required> Ich willige ein, dass meine Angaben zur Erstellung eines KI-Reports automatisiert durch ein Sprachmodell (GPT) verarbeitet werden.</label>
    </div>

    <button class="button" type="submit">Analyse starten</button>
</form>

<pre id="debugOutput">Debug wartet...</pre>

<script>
const debug = document.getElementById("debugOutput");
document.getElementById("mainForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(e.target));
    debug.textContent = "üì§ Sende Daten an Server...\n" + JSON.stringify(data, null, 2);

    try {
        const res = await fetch("https://make-ki-backend-neu-production.up.railway.app/briefing", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(data)
        });

        debug.textContent += "\n‚úÖ Server Status: " + res.status;
        if (!res.ok) {
            debug.textContent += "\n‚ùå Fehler: " + await res.text();
            return;
        }

        const json = await res.json();
        debug.textContent += "\nüì¶ Antwort: \n" + JSON.stringify(json, null, 2);

        if (json.pdf_url) {
            const filename = json.pdf_url.split("/").pop();
            window.location.href = "/formular/thankyou.html?file=" + encodeURIComponent(filename);
        } else {
            alert("Es gab ein Problem bei der Erstellung Ihres Berichts.");
        }
    } catch (err) {
        debug.textContent += "\n‚ùå Netzwerkfehler: " + err;
        console.error(err);
    }
});
</script>
</body>
</html>
