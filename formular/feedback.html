<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Feedback · KI‑Status‑Report</title>
  <link rel="stylesheet" href="./feedback-page.css" />
</head>
<body>
  <header class="brand-header">
    <div class="brand-inner">
      <img class="brand-logo" src="/assets/ki-sicherheit-logo.webp" alt="KI‑Sicherheit.jetzt" onerror="this.style.display='none'">
      <div class="brand-texts">
        <h1>Feedback zum KI‑Status‑Report</h1>
        <p class="subtitle">2 Minuten · hilft uns, den Report noch wertvoller zu machen</p>
      </div>
      <div class="brand-badges" aria-hidden="true">
        <img src="/assets/tuev-logo-transparent.webp" alt="" onerror="this.style.display='none'">
        <img src="/assets/eu-ai.svg" alt="" onerror="this.style.display='none'">
        <img src="/assets/dsgvo.svg" alt="" onerror="this.style.display='none'">
      </div>
    </div>
  </header>

  <main class="form-shell">
    <section class="form-container card">
      <p class="intro">
        Danke, dass du den KI‑Status‑Report getestet hast. Mit deinem kurzen Feedback
        hilfst du uns, Sprache, Lesefluss und Handlungsempfehlungen weiter zu verbessern.
      </p>

      <form id="feedback-form" novalidate>
        <input type="hidden" name="email" id="feedback-email" />

        <div class="form-group">
          <label for="hilfe">Wie hilfreich war der KI‑Status‑Report insgesamt?</label>
          <select name="hilfe" id="hilfe" required>
            <option value="">Bitte wählen</option>
            <option value="gar nicht hilfreich">Gar nicht hilfreich</option>
            <option value="eher wenig hilfreich">Eher wenig hilfreich</option>
            <option value="teils/teils">Teils/teils</option>
            <option value="ziemlich hilfreich">Ziemlich hilfreich</option>
            <option value="sehr hilfreich">Sehr hilfreich</option>
          </select>
          <small class="hint">Kurzer Gesamteindruck – aus dem Bauch heraus ist völlig ok.</small>
        </div>

        <div class="form-group">
          <label for="verstaendlich1">Wie verständlich sind Analyse & Auswertung?</label>
          <select name="verstaendlich_analyse" id="verstaendlich1" required>
            <option value="">Bitte wählen</option>
            <option value="überhaupt nicht verständlich">Überhaupt nicht verständlich</option>
            <option value="eher schwer verständlich">Eher schwer verständlich</option>
            <option value="teils verständlich, teils nicht">Teils verständlich, teils nicht</option>
            <option value="größtenteils verständlich">Größtenteils verständlich</option>
            <option value="sehr verständlich">Sehr verständlich</option>
          </select>
        </div>

        <div class="form-group">
          <label for="verstaendlich2">Sind die konkreten Handlungsempfehlungen klar?</label>
          <select name="verstaendlich_empfehlung" id="verstaendlich2" required>
            <option value="">Bitte wählen</option>
            <option value="überhaupt nicht klar">Überhaupt nicht klar</option>
            <option value="teilweise unklar">Teilweise unklar</option>
            <option value="teils klar, teils unklar">Teils klar, teils unklar</option>
            <option value="größtenteils klar">Größtenteils klar</option>
            <option value="sehr klar und verständlich">Sehr klar und verständlich</option>
          </select>
        </div>

        <div class="form-group">
          <label for="vertrauen">Wie seriös und vertrauenswürdig wirkt der Report?</label>
          <select name="vertrauen" id="vertrauen" required>
            <option value="">Bitte wählen</option>
            <option value="überhaupt nicht seriös">Überhaupt nicht seriös</option>
            <option value="eher wenig seriös">Eher wenig seriös</option>
            <option value="mittelmäßig seriös">Mittelmäßig seriös</option>
            <option value="ziemlich seriös">Ziemlich seriös</option>
            <option value="sehr seriös und vertrauenswürdig">Sehr seriös und vertrauenswürdig</option>
          </select>
        </div>

        <div class="form-group">
          <label for="serio">Falls „unseriös“: Was würde Vertrauen stärken?</label>
          <textarea name="serio" id="serio" placeholder="Dein Vorschlag (optional)"></textarea>
        </div>

        <div class="form-group">
          <label for="textstellen">Gab es Textstellen, die zu kompliziert oder zu lang sind?</label>
          <textarea name="textstellen" id="textstellen" placeholder="Kurzer Hinweis (optional)"></textarea>
        </div>

        <div class="form-group">
          <label for="dauer">Wie fandest du den Umfang des Fragebogens?</label>
          <select name="dauer" id="dauer" required>
            <option value="">Bitte wählen</option>
            <option>Okay so</option>
            <option>Etwas lang, aber noch akzeptabel</option>
            <option>Viel zu lang</option>
          </select>
        </div>

        <div class="form-group">
          <label for="unsicher">Gab es Stellen, zu denen du gern Rückfragen gestellt hättest?</label>
          <textarea name="unsicher" id="unsicher" placeholder="Dein Feedback (optional)"></textarea>
        </div>

        <div class="form-group">
          <label for="features">Welche zusätzlichen Inhalte/Features wünschst du dir?</label>
          <textarea name="features" id="features" placeholder="z. B. Benchmarks, ROI-Schätzung, Praxisbeispiel … (optional)"></textarea>
        </div>

        <div class="form-group">
          <label for="freitext">Sonst noch Feedback, Ideen oder Vorschläge?</label>
          <textarea name="freitext" id="freitext" placeholder="Alles, was dir einfällt (optional)"></textarea>
        </div>

        <div class="form-group referral">
          <p class="label-like">Wem sollten wir vom KI‑Status‑Report erzählen?</p>
          <div class="grid-2">
            <div>
              <label for="tipp_name">Name</label>
              <input type="text" name="tipp_name" id="tipp_name" placeholder="Vor- und Nachname" />
            </div>
            <div>
              <label for="tipp_firma">Unternehmen</label>
              <input type="text" name="tipp_firma" id="tipp_firma" placeholder="Unternehmen" />
            </div>
          </div>
          <label for="tipp_email">E‑Mail</label>
          <input type="email" name="tipp_email" id="tipp_email" placeholder="E‑Mail-Adresse" />
        </div>

        <div class="privacy-section">
          <label>
            <input type="checkbox" id="privacy-ok" required />
            Ich bin einverstanden, dass mein Feedback intern ausgewertet wird (DSGVO-konform, keine Weitergabe an Dritte).
          </label>
        </div>

        <button type="submit" class="btn-primary">Feedback absenden</button>
        <p id="form-msg" class="feedback" role="alert" aria-live="polite" style="display:none;"></p>
      </form>
    </section>
  </main>

  <footer class="footer">
    <div class="lizenz">© 2025 KI‑Sicherheit.jetzt · DSGVO & EU‑AI‑Act‑ready</div>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const token = localStorage.getItem("jwt");
      if (!token) {
        window.location.href = "/login.html";
        return;
      }
      function getEmailFromJWT(token) {
        try {
          const payload = JSON.parse(atob(token.split(".")[1]));
          return payload.email || payload.sub || null;
        } catch (e) { return null; }
      }
      const email = getEmailFromJWT(token);
      const emailInput = document.getElementById("feedback-email");
      if (emailInput && email) emailInput.value = email;

      const form = document.getElementById("feedback-form");
      const msg  = document.getElementById("form-msg");

      form.addEventListener("submit", async function(e) {
        e.preventDefault();
        if (!document.getElementById("privacy-ok").checked) {
          msg.textContent = "Bitte Datenschutzhinweis bestätigen.";
          msg.classList.add("error");
          msg.style.display = "block";
          return;
        }
        const formData = new FormData(form);
        const data = {}; formData.forEach((v, k) => data[k] = v);

        try {
          const res = await fetch('https://make-ki-backend-neu-production.up.railway.app/feedback', {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              ...(token ? { "Authorization": "Bearer " + token } : {})
            },
            body: JSON.stringify(data)
          });
          if (res.ok) {
            window.location.href = "danke.html";
          } else {
            msg.textContent = "Fehler beim Absenden. Bitte später erneut versuchen.";
            msg.classList.add("error");
            msg.style.display = "block";
          }
        } catch(err) {
          msg.textContent = "Netzwerkproblem. Bitte später erneut versuchen.";
          msg.classList.add("error");
          msg.style.display = "block";
        }
      });
    });
  </script>
</body>
</html>
