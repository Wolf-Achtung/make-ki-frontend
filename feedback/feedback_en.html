<!-- File: feedback_en.html -->
<!DOCTYPE html>
<html lang="en" data-lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Feedback for the AI Checkup Report</title>
<link rel="preload" as="style" href="feedback-page.css"/>
<link rel="stylesheet" href="feedback-page.css"/>
<script>const API_BASE="https://make-ki-backend-neu-production.up.railway.app";</script>
</head>
<body>
  <header class="brand-header">
    <div class="brand-inner">
      <div class="brand-texts">
        <h1>Feedback on the AI Checkup Report</h1>
        <p class="subtitle">2 minutes. Helps us improve language, flow and recommendations.</p>
      </div>
      <div class="brand-badges"><img src="/assets/tuev.svg" alt="TÜV"/><img src="/assets/eu.svg" alt="EU"/></div>
    </div>
  </header>

  <main class="form-shell">
    <form id="feedback-form" class="form-container card" novalidate>
      <input type="hidden" name="variant" id="variant"/>
      <input type="hidden" name="report_version" id="report_version"/>
      <input type="hidden" name="lang_ui" id="lang_ui" value="en"/>
      <input type="hidden" name="timestamp" id="timestamp"/>

      <p class="intro">We only use your answers to improve the product.</p>

      <div class="form-group">
        <label for="user_email" class="req">Your email address</label>
        <input type="email" name="user_email" id="user_email" required maxlength="160" placeholder="Email address"/>
        <span class="hint">Required (for follow‑ups if needed; no marketing).</span>
      </div>

      <div class="form-group">
        <label for="hilfe" class="req">How helpful was the AI Checkup overall?</label>
        <select name="hilfe" id="hilfe" required>
          <option value="">Please choose</option>
          <option>Very helpful</option><option>Quite helpful</option><option>So-so</option><option>Rather unhelpful</option><option>Not helpful at all</option>
        </select>
      </div>

      <div class="grid-2">
        <div class="form-group">
          <label for="verstaendlich1" class="req">How understandable are the analysis & evaluation?</label>
          <select name="verstaendlich_analyse" id="verstaendlich1" required>
            <option value="">Please choose</option>
            <option>Very understandable</option><option>Mostly understandable</option><option>Partly understandable</option><option>Rather hard to understand</option><option>Not understandable at all</option>
          </select>
        </div>
        <div class="form-group">
          <label for="verstaendlich2" class="req">Are the recommendations clearly formulated?</label>
          <select name="verstaendlich_empfehlung" id="verstaendlich2" required>
            <option value="">Please choose</option>
            <option>Very clear and understandable</option><option>Mostly clear</option><option>Partly clear, partly unclear</option><option>Partly unclear</option><option>Not clear at all</option>
          </select>
        </div>
      </div>

      <div class="grid-2">
        <div class="form-group">
          <label for="vertrauen" class="req">How credible & trustworthy does the report appear?</label>
          <select name="vertrauen" id="vertrauen" required>
            <option value="">Please choose</option>
            <option>Very credible & trustworthy</option><option>Quite credible</option><option>Moderately credible</option><option>Rather not credible</option><option>Not credible at all</option>
          </select>
        </div>
        <div class="form-group">
          <label for="dauer" class="req">How did you find the length?</label>
          <select name="dauer" id="dauer" required>
            <option value="">Please choose</option>
            <option>Fine as is</option><option>A bit long but still OK</option><option>Far too long</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="serio">What would further increase your trust?</label>
        <textarea name="serio" id="serio" maxlength="1500" placeholder="What would increase your trust?"></textarea>
        <div class="hint" id="c_serio">0 / 1500</div>
      </div>
      <div class="form-group">
        <label for="textstellen">Were there any passages that were too complex, long or unclear?</label>
        <textarea name="textstellen" id="textstellen" maxlength="1500" placeholder="Please briefly describe …"></textarea>
        <div class="hint" id="c_textstellen">0 / 1500</div>
      </div>
      <div class="form-group">
        <label for="unsicher">Where would you like additional explanations or clarifications?</label>
        <textarea name="unsicher" id="unsicher" maxlength="1500" placeholder="Questions or missing explanations …"></textarea>
        <div class="hint" id="c_unsicher">0 / 1500</div>
      </div>
      <div class="form-group">
        <label for="features">Which additional content would be helpful (tables, charts, examples …)?</label>
        <textarea name="features" id="features" maxlength="1500" placeholder="E.g., more tables, examples, charts …"></textarea>
        <div class="hint" id="c_features">0 / 1500</div>
      </div>
      <div class="form-group">
        <label for="freitext">Any other feedback, ideas or suggestions?</label>
        <textarea name="freitext" id="freitext" maxlength="1500" placeholder="Further thoughts or suggestions …"></textarea>
        <div class="hint" id="c_freitext">0 / 1500</div>
      </div>

      <div class="form-group">
        <span class="label-like">Optional: Referral</span>
        <div class="grid-2">
          <div>
            <label for="tipp_name">Name</label>
            <input type="text" name="tipp_name" id="tipp_name" maxlength="120" placeholder="Full name"/>
          </div>
          <div>
            <label for="tipp_firma">Company</label>
            <input type="text" name="tipp_firma" id="tipp_firma" maxlength="120" placeholder="Company"/>
          </div>
        </div>
        <label for="tipp_email">Email</label>
        <input type="email" name="tipp_email" id="tipp_email" maxlength="160" placeholder="Email address"/>
      </div>

      <button type="submit" class="btn-primary">Submit feedback</button>
      <div id="status" class="feedback" role="status" aria-live="polite"></div>
    </form>
  </main>

  <footer class="footer"><div class="lizenz">© KI‑Sicherheit.jetzt · EU AI · GDPR</div></footer>

<script>
(function(){
  const ENDPOINTS = [
    `${API_BASE}/feedback`,
    `${API_BASE}/api/feedback`,
    `${API_BASE}/v1/feedback`,
    `${API_BASE}/feedback_email`
  ];
  const qs = (n) => new URLSearchParams(location.search).get(n) || "";
  document.getElementById("variant").value = qs("variant") || "";
  document.getElementById("report_version").value = qs("version") || "";

  const setCount = (id) => {
    const ta = document.getElementById(id.replace("c_",""));
    const c = document.getElementById(id);
    const max = parseInt(ta.getAttribute("maxlength")||"0",10);
    const upd = () => { c.textContent = `${ta.value.length} / ${max}`; };
    ta.addEventListener("input", upd); upd();
  };
  ["c_serio","c_textstellen","c_unsicher","c_features","c_freitext"].forEach(setCount);

  function serialize(form){
    const fd = new FormData(form); const obj = {};
    fd.forEach((v,k)=> obj[k]=v); obj.timestamp = new Date().toISOString();
    obj.email = obj.email || obj.user_email; obj.lang_ui = "en";
    return obj;
  }

  async function postToAny(urls, payload){
    let lastErr = null;
    for (const u of urls){
      try{
        const res = await fetch(u, { method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(payload) });
        if (res.ok) return true;
        lastErr = `HTTP ${res.status}`;
      }catch(e){ lastErr = e?.message || e; }
    }
    throw lastErr || new Error("submit failed");
  }

  document.getElementById("feedback-form").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const form = e.target;
    const status = document.getElementById("status");
    status.className = "feedback"; status.textContent = "Sending feedback …"; status.style.display="block";
    try{
      await postToAny(ENDPOINTS, serialize(form));
      status.className = "feedback ok"; status.textContent = "Thanks – feedback sent.";
      form.reset();
      ["c_serio","c_textstellen","c_unsicher","c_features","c_freitext"].forEach(id=>{
        const el=document.getElementById(id); if(el){el.textContent = el.textContent.replace(/^\d+/, "0");}
      });
    }catch(err){
      console.error(err);
      status.className = "feedback error"; status.textContent = "Sending failed. Please try again later.";
    }
  });
})();
</script>
</body>
</html>
