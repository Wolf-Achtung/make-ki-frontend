<!-- File: feedback.html -->
<!DOCTYPE html>
<html lang="de" data-lang="de">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Feedback – KI‑Checkup</title>
  <link rel="preload" as="style" href="feedback-page.css"/>
  <link rel="stylesheet" href="feedback-page.css"/>
  <script>const API_BASE="https://make-ki-backend-neu-production.up.railway.app";</script>
</head>
<body>
  <header class="brand-header">
    <div class="brand-inner">
      <div class="brand-texts">
        <h1 class="brand-title">Feedback zum KI‑Checkup‑Report</h1>
        <p class="subtitle">2 Minuten. Hilft uns, Sprache, Lesefluss und Empfehlungen weiter zu verbessern.</p>
      </div>
      <div class="brand-badges"><img src="/assets/tuev.svg" alt="TÜV"/><img src="/assets/eu.svg" alt="EU"/></div>
    </div>
  </header>

  <main class="form-shell">
    <form id="feedback-form" class="form-container card" novalidate>
      <!-- Hidden -->
      <input type="hidden" name="variant" id="variant"/>
      <input type="hidden" name="report_version" id="report_version"/>
      <input type="hidden" name="lang_ui" id="lang_ui" value="de"/>
      <input type="hidden" name="timestamp" id="timestamp"/>

      <p class="intro">Wir nutzen deine Angaben ausschließlich zur Verbesserung des Produkts.</p>

      <div class="form-group">
        <label for="user_email" class="req">Ihre E‑Mail‑Adresse</label>
        <input type="email" name="user_email" id="user_email" required maxlength="160" placeholder="E‑Mail‑Adresse"/>
        <span class="hint">Pflichtfeld (für eventuelle Rückfragen, keine Werbung).</span>
      </div>

      <div class="form-group">
        <label for="hilfe" class="req">Wie hilfreich war der KI‑Checkup insgesamt?</label>
        <select name="hilfe" id="hilfe" required>
          <option value="">Bitte wählen</option>
          <option>Sehr hilfreich</option><option>Ziemlich hilfreich</option><option>Teils/teils</option><option>Eher wenig hilfreich</option><option>Gar nicht hilfreich</option>
        </select>
      </div>

      <div class="grid-2">
        <div class="form-group">
          <label for="verstaendlich1" class="req">Wie verständlich sind Analyse &amp; Auswertung?</label>
          <select name="verstaendlich_analyse" id="verstaendlich1" required>
            <option value="">Bitte wählen</option>
            <option>Sehr verständlich</option><option>Größtenteils verständlich</option><option>Teils verständlich, teils nicht</option><option>Eher schwer verständlich</option><option>Überhaupt nicht verständlich</option>
          </select>
        </div>
        <div class="form-group">
          <label for="verstaendlich2" class="req">Sind die Handlungsempfehlungen klar formuliert?</label>
          <select name="verstaendlich_empfehlung" id="verstaendlich2" required>
            <option value="">Bitte wählen</option>
            <option>Sehr klar und verständlich</option><option>Größtenteils klar</option><option>Teils klar, teils unklar</option><option>Teilweise unklar</option><option>Überhaupt nicht klar</option>
          </select>
        </div>
      </div>

      <div class="grid-2">
        <div class="form-group">
          <label for="vertrauen" class="req">Wie seriös und vertrauenswürdig wirkt der Report?</label>
          <select name="vertrauen" id="vertrauen" required>
            <option value="">Bitte wählen</option>
            <option>Sehr seriös und vertrauenswürdig</option><option>Ziemlich seriös</option><option>Mittelmäßig seriös</option><option>Eher wenig seriös</option><option>Überhaupt nicht seriös</option>
          </select>
        </div>
        <div class="form-group">
          <label for="dauer" class="req">Wie fanden Sie den Umfang?</label>
          <select name="dauer" id="dauer" required>
            <option value="">Bitte wählen</option>
            <option>Okay so</option><option>Etwas lang, aber noch akzeptabel</option><option>Viel zu lang</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="serio">Was würde Ihr Vertrauen zusätzlich stärken?</label>
        <textarea name="serio" id="serio" maxlength="1500" placeholder="Was stärkt Ihr Vertrauen?"></textarea>
        <div class="hint" id="c_serio">0 / 1500</div>
      </div>
      <div class="form-group">
        <label for="textstellen">Gab es Textstellen, die zu kompliziert, zu lang oder unklar waren?</label>
        <textarea name="textstellen" id="textstellen" maxlength="1500" placeholder="Bitte Textstellen kurz beschreiben …"></textarea>
        <div class="hint" id="c_textstellen">0 / 1500</div>
      </div>
      <div class="form-group">
        <label for="unsicher">Wo wünschen Sie sich zusätzliche Erklärungen oder Zwischenfragen?</label>
        <textarea name="unsicher" id="unsicher" maxlength="1500" placeholder="Fragen, Unklarheiten oder fehlende Erläuterungen …"></textarea>
        <div class="hint" id="c_unsicher">0 / 1500</div>
      </div>
      <div class="form-group">
        <label for="features">Welche zusätzlichen Inhalte wären hilfreich (Tabellen, Diagramme, Beispiele …)?</label>
        <textarea name="features" id="features" maxlength="1500" placeholder="Zum Beispiel: mehr Tabellen, Beispiele, Diagramme …"></textarea>
        <div class="hint" id="c_features">0 / 1500</div>
      </div>
      <div class="form-group">
        <label for="freitext">Sonst noch Feedback, Ideen oder Vorschläge?</label>
        <textarea name="freitext" id="freitext" maxlength="1500" placeholder="Weitere Gedanken oder Anregungen …"></textarea>
        <div class="hint" id="c_freitext">0 / 1500</div>
      </div>

      <div class="form-group">
        <span class="label-like">Optional: Empfehlung</span>
        <div class="grid-2">
          <div>
            <label for="tipp_name">Name</label>
            <input type="text" name="tipp_name" id="tipp_name" maxlength="120" placeholder="Vor- und Nachname"/>
          </div>
          <div>
            <label for="tipp_firma">Unternehmen</label>
            <input type="text" name="tipp_firma" id="tipp_firma" maxlength="120" placeholder="Unternehmen"/>
          </div>
        </div>
        <label for="tipp_email">E‑Mail</label>
        <input type="email" name="tipp_email" id="tipp_email" maxlength="160" placeholder="E‑Mail-Adresse"/>
      </div>

      <button type="submit" class="btn-primary">Feedback absenden</button>
      <div id="status" class="feedback" role="status" aria-live="polite"></div>
    </form>
  </main>

  <footer class="footer"><div class="lizenz">© KI‑Sicherheit.jetzt · EU AI · DSGVO</div></footer>

<script>
(function(){
  const ENDPOINTS = [
    `${API_BASE}/feedback`,
    `${API_BASE}/api/feedback`,
    `${API_BASE}/v1/feedback`,
    `${API_BASE}/feedback_email` // reiner Mail-Fallback
  ];
  const qs = (n) => new URLSearchParams(location.search).get(n) || "";
  // variant / version aus URL übernehmen
  document.getElementById("variant").value = qs("variant") || "";
  document.getElementById("report_version").value = qs("version") || "";

  const setCount = (id) => {
    const ta = document.getElementById(id.replace("c_",""));
    const c = document.getElementById(id);
    const max = parseInt(ta.getAttribute("maxlength")||"0",10);
    const upd = () => { c.textContent = `${ta.value.length} / ${max}`; };
    ta.addEventListener("input", upd); upd();
  };
  ["c_serio","c_textstellen","c_unsicher","c_features","c_freitext"].forEach(setCount);

  function serialize(form){
    const fd = new FormData(form); const obj = {};
    fd.forEach((v,k)=> obj[k]=v); obj.timestamp = new Date().toISOString();
    // Sichtbare Email spiegelt die Pflichtadresse
    obj.email = obj.email || obj.user_email;
    obj.lang_ui = "de";
    return obj;
  }

  async function postToAny(urls, payload){
    let lastErr = null;
    for (const u of urls){
      try{
        const res = await fetch(u, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(payload)
        });
        if (res.ok) return true;
        lastErr = `HTTP ${res.status}`;
      }catch(e){ lastErr = e?.message || e; }
    }
    throw lastErr || new Error("submit failed");
  }

  document.getElementById("feedback-form").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const form = e.target;
    const status = document.getElementById("status");
    status.className = "feedback"; status.textContent = "Sende Feedback …"; status.style.display="block";
    try{
      await postToAny(ENDPOINTS, serialize(form));
      status.className = "feedback ok"; status.textContent = "Vielen Dank – Feedback gesendet.";
      form.reset();
      ["c_serio","c_textstellen","c_unsicher","c_features","c_freitext"].forEach(id=>{
        const el=document.getElementById(id); if(el){el.textContent = el.textContent.replace(/^\d+/, "0");}
      });
    }catch(err){
      console.error(err);
      status.className = "feedback error"; status.textContent = "Fehler beim Senden. Bitte später erneut versuchen.";
    }
  });
})();
</script>
</body>
</html>
